# ğŸ—ï¸ AI PLATFORM AUTOMATION - 5-SCRIPT FRAMEWORK

## ğŸ“‹ SCRIPT RESPONSIBILITIES

### 0ï¸âƒ£ 0-complete-cleanup.sh
**PURPOSE**: Nuclear cleanup and environment reset
**RESPONSIBILITIES**:
- Stop all containers
- Remove all Docker volumes/networks
- Clean up configuration files
- Reset environment to clean state
- Mount/unmount volumes properly

### 1ï¸âƒ£ 1-setup-system.sh  
**PURPOSE**: System configuration and preparation
**RESPONSIBILITIES**:
- Detect and mount volumes (NEW!)
- User and domain configuration
- Generate compose templates
- Create directory structure
- Set up environment variables
- Install dependencies

### 2ï¸âƒ£ 2-deploy-services.sh
**PURPOSE**: Service deployment and management
**RESPONSIBILITIES**:
- Deploy all selected services
- Non-root user mapping
- Health checks and monitoring
- AppArmor security
- Service lifecycle management

### 3ï¸âƒ£ 3-configure-services.sh
**PURPOSE**: Service configuration and optimization
**RESPONSIBILITIES**:
- Configure service integrations
- Set up SSL certificates
- Configure proxy routing
- Optimize performance
- Service dependencies

### 4ï¸âƒ£ 4-add-service.sh
**PURPOSE**: Add new services to platform
**RESPONSIBILITIES**:
- Service template generation
- Integration with existing services
- Configuration management
- Update service registry

## ğŸ”„ DATA FLOW ARCHITECTURE

```
Script 0 â†’ Clean Environment
     â†“
Script 1 â†’ Setup System + Mount Volumes
     â†“
Script 2 â†’ Deploy Services
     â†“
Script 3 â†’ Configure Services
     â†“
Script 4 â†’ Add Services (as needed)
```

## ğŸ“ SHARED DATA STRUCTURE

```
/mnt/data/
â”œâ”€â”€ compose/           # Generated by Script 1, used by Script 2
â”œâ”€â”€ config/            # Service configurations
â”œâ”€â”€ logs/              # Centralized logging
â”œâ”€â”€ metadata/           # Service selection and state
â””â”€â”€ .env               # Environment variables
```

## ğŸ¯ REFACTORING PRINCIPLES

1. **Single Responsibility**: Each script has one clear purpose
2. **Data Sharing**: Scripts communicate through /mnt/data/
3. **State Management**: Each script saves/loads state properly
4. **Error Handling**: Graceful failure and recovery
5. **Modularity**: Scripts can run independently
6. **Idempotency**: Scripts can be rerun safely

## ğŸ”§ REFACTORING TASKS

### Script 0 - Cleanup:
- Add volume detection and proper unmounting
- Improve cleanup safety
- Add backup/restore functionality

### Script 1 - Setup:
- Integrate volume-detector.sh
- Fix domain configuration consistency
- Add volume validation
- Improve compose template generation

### Script 2 - Deploy:
- Fix volume path issues
- Improve health checks
- Add dependency management
- Better error recovery

### Script 3 - Configure:
- SSL certificate management
- Proxy routing configuration
- Service integration setup
- Performance optimization

### Script 4 - Add Service:
- Service template system
- Integration validation
- Configuration generation
- Registry management

## ğŸš€ IMPLEMENTATION PLAN

Phase 1: Refactor Core Scripts (0, 1, 2)
Phase 2: Enhance Configuration Scripts (3, 4)
Phase 3: Add Advanced Features
Phase 4: Testing and Documentation
