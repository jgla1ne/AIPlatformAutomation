# SSRF Protection Proxy for Dify
http_port 3128

# Access control
acl localnet src 172.16.0.0/12
acl SSL_ports port 443
acl Safe_ports port 80
acl Safe_ports port 443
acl CONNECT method CONNECT

# Deny access to localhost and private networks
acl to_localhost dst 127.0.0.0/8 0.0.0.0/32
acl to_metadata dst 169.254.0.0/16
acl private_networks dst 10.0.0.0/8 172.16.0.0/12 192.168.0.0/16

http_access deny to_localhost
http_access deny to_metadata
http_access deny private_networks

# Allow safe ports
http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports

# Allow local network
http_access allow localnet
http_access allow localhost

# Deny all else
http_access deny all

# Cache settings
cache deny all

# Logging
access_log stdio:/dev/stdout
cache_log /dev/null

